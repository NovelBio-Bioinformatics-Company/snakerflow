<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xmlns:aop="http://www.springframework.org/schema/aop"
     xmlns:tx="http://www.springframework.org/schema/tx"
     xmlns:p="http://www.springframework.org/schema/p"
     xmlns:jdbc="http://www.springframework.org/schema/jdbc"
     xmlns:context="http://www.springframework.org/schema/context"
     xmlns:mongo="http://www.springframework.org/schema/data/mongo"
     xmlns:util=" http://www.springframework.org/schema/util"
     xsi:schemaLocation="
     http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
     http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc-3.0.xsd
     http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
     http://www.springframework.org/schema/data/mongo http://www.springframework.org/schema/data/mongo/spring-mongo-1.0.xsd
     http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd">
    
    <aop:aspectj-autoproxy/>
    <bean class="org.springframework.aop.aspectj.annotation.AnnotationAwareAspectJAutoProxyCreator" />  
     <bean id="OptimisticConcurrencyControlAspect"
		class="com.novelbio.erp.base.aspect.OptimisticConcurrencyControlAspect"/>
    
   	<!-- 读取数据源配置文件 -->
	<bean
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"
		p:location="dataSource.properties"
		p:ignoreUnresolvablePlaceholders="true" />

	<!-- 启用注解 -->
	<context:annotation-config />
	
	<!-- 全局变量 -->
	<!-- 全局变量 -->
	<bean id="globeParameters" class="com.novelbio.erp.base.init.GlobeParameters">
		<property name="mapParams">
			<map>
				<entry key="GoPathway_noteId" value="52f5fc22e4b084b1efc0f05f" />
				<entry key="FastQC_noteId" value="52f5fc0be4b084b1efc0f05d" />
				<entry key="BedFileOperate_noteId" value="530ff557e4b0381984eadc6c" />
				<entry key="SnpAnno_noteId" value="530ff571e4b0381984eadc6e" />
				<entry key="PlotChromosome_noteId" value="530ff58ae4b0381984eadc70" />
				<entry key="PlotTss_noteId" value="530ff5a6e4b0381984eadc72" />
				<entry key="SamToBam_noteId" value="530ff5cde4b0381984eadc74" />
				<entry key="SamAndRPKM_noteId" value="530ff5e2e4b0381984eadc76" />
				<entry key="RNASeqMap_noteId" value="530ff5fee4b0381984eadc78" />
				<entry key="DNASeqMap_noteId" value="530ff612e4b0381984eadc7a" />
				<entry key="Report_noteId" value="530ff627e4b0381984eadc7c" />
				<entry key="Other_noteId" value="530ff639e4b0381984eadc7e" />
				<entry key="MiRNATarget_noteId" value="530ff64ce4b0381984eadc80" />
				<entry key="MiRNASeqAnalysis_noteId" value="530ff43fe4b0381984eadc6a" />
				<entry key="RfamAnalysis_noteId" value="531002eee4b0381984eadc8d" />
				<entry key="RrRNAFilter_noteId" value="534c9696e4b058e83139e7ba" />
				<entry key="DifGene_noteId" value="5358c4e9e4b0cd80645bd77a" />
				
				<!-- 全局变量 -->
				<entry key="isdev" value="${mongo.dbName}"/>
			</map>
		</property>
	</bean>
	
	<!-- 扫描此包下的注解 -->
	<context:component-scan base-package="com.novelbio.erp" />
	<context:component-scan base-package="org.snaker.engine" /> 
	
	<!-- 定义mongo对象，对应的是mongodb官方jar包中的Mongo，replica-set设置集群副本的ip地址和端口 -->
	<mongo:mongo id="mongo" replica-set="${mongo.url}">
		<!-- 一些连接属性的设置 -->
		<mongo:options connections-per-host="${mongo.connectionsPerHost}"
			threads-allowed-to-block-for-connection-multiplier="${mongo.threadsAllowedToBlockForConnectionMultiplier}"
			connect-timeout="${mongo.connectTimeout}"
			max-wait-time="${mongo.maxWaitTime}"
			auto-connect-retry="${mongo.autoConnectRetry}"
			socket-keep-alive="${mongo.socketKeepAlive}"
			socket-timeout="${mongo.socketTimeout}"
			slave-ok="${mongo.slaveOk}"
			write-number="1"
			write-timeout="0"
			write-fsync="false"
		/>
	</mongo:mongo>


	<!-- mongo的工厂，通过它来取得mongo实例,dbname为mongodb的数据库名，没有的话会自动创建 -->
	<mongo:db-factory 
		dbname="${mongo.dbName}" 
		mongo-ref="mongo"
		username="${mongo.username}" 
    	password="${mongo.password}" 
	/>

	<!-- mongodb的主要操作对象，所有对mongodb的增删改查的操作都是通过它完成 -->
	<bean id="mongoTemplate" class="org.springframework.data.mongodb.core.MongoTemplate">
		<constructor-arg name="mongoDbFactory" ref="mongoDbFactory" />
	</bean>

	<!-- 映射转换器，扫描back-package目录下的文件，根据注释，把它们作为mongodb的一个collection的映射 -->
	<mongo:mapping-converter base-package="com.novelbio.erp.*.*.model" />
	<mongo:mapping-converter base-package="org.snaker.engine.access" /> 
	
	<!-- mongodb bean的仓库目录，会自动扫描扩展了MongoRepository接口的接口进行注入 -->
	<mongo:repositories base-package="com.novelbio.erp.*.*.dao" />
 	<mongo:repositories base-package="org.snaker.engine.access" /> 
	
</beans>
